<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval'" />

    <link rel="stylesheet" href="./asset/css/bootstrap.min.css">
    <link rel="stylesheet" href="./asset/css/codemirror.min.css">
    <link rel="stylesheet" href="./asset/css/monokai.min.css">

    <link rel="stylesheet" href="./asset/css/custom.css">

    <script src="../base1/cockpit.js"></script>

    <script src="./asset/js/codemirror/codemirror.min.js" type="text/javascript"></script>
    <script src="./asset/js/codemirror/meta.min.js" type="text/javascript"></script>
    <script src="./asset/js/codemirror/active-line.min.js" type="text/javascript"></script>
    <script src="./asset/js/codemirror/autorefresh.min.js" type="text/javascript"></script>

    <!-- <script src="./asset/js/codemirror/yaml-frontmatter.min.js" type="text/javascript"></script> -->
    <script src="./asset/js/codemirror/yaml.min.js" type="text/javascript"></script>
    <script src="./asset/js/codemirror/yaml-lint.min.js" type="text/javascript"></script>
    <script src="./asset/js/codemirror/closebrackets.min.js" type="text/javascript"></script>
    <script src="./asset/js/codemirror/matchbrackets.min.js" type="text/javascript"></script>

    <script src="./asset/js/js-yaml.min.js" type="text/javascript"></script>
    <script src="./asset/js/async.min.js" type="text/javascript"></script>
    <script src="./asset/js/mosdns_event.js" type="text/javascript"></script>

    <script type="text/javascript" charset="utf-8">

        console.log(mosdnsui);

        window.onload = () => {
            mosdnsui.initCodeMirror();
            mosdnsui.initBootstrapDns();
            mosdnsui.readMosdnsFiles();
        };

    </script>

</head>

<body>

    <div id="spinner" class="position-fixed position-fixed-spinner">
        <div class="d-flex justify-content-center">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>

    <div class="container">

        <div style="margin-top: 3rem;margin-bottom: 3rem;">

            <nav>
                <div style="position: relative;" class="nav nav-tabs" id="nav-tab" role="tablist">
                    <button id="statusBtn" class="nav-link nav-link-main active" onclick="mosdnsui.btn.base()"
                        data-toggle="tab" data-target="#nav-status" type="button" role="tab">
                        状态
                    </button>
                    <button class="nav-link nav-link-main" onclick="mosdnsui.btn.base()" data-toggle="tab"
                        data-target="#nav-home" type="button" role="tab">
                        基本设置
                    </button>
                    <button class="nav-link nav-link-main " onclick="mosdnsui.btn.base()" data-toggle="tab"
                        data-target="#nav-rule" type="button" role="tab">
                        规则列表
                    </button>
                    <button class="nav-link nav-link-main " onclick="mosdnsui.btn.base()" data-toggle="tab"
                        data-target="#nav-data" type="button" role="tab">
                        更新数据库
                    </button>
                    <button class="nav-link nav-link-main " onclick="mosdnsui.btn.base()" data-toggle="tab"
                        data-target="#nav-install" type="button" role="tab">
                        配置&安装
                    </button>
                    <button onclick="mosdnsui.btn.save()" class="nav-link nav-link-save"
                        style="position: absolute; right: 0;" type="button" role="tab">保存</button>

                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade tab-pane-main active show " id="nav-status" role="tabpanel">
                    <div data-parent="base" class="tab-pane fade show active" role="tabpanel">
                        <div class="row" style="margin-top: 1.5rem">
                            <div class="col">
                                <div id="mosdnsstatus" class="p-3 mb-2 bg-secondary bg-gradient text-white ">
                                    <textarea id="mosdnsmessage" disabled
                                        style="resize: none;background-color: transparent; border: none; color: #fff;"
                                        class="form-control"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade tab-pane-main  show " id="nav-home" role="tabpanel">

                    <div class="row" style="margin-top: 1.5rem">
                        <div class="col-3" style="border-right: 1px solid #dadada;">
                            <div class="nav flex-column nav-pills" role="tablist">
                                <button onclick="mosdnsui.btn.card()" class="nav-link active" data-toggle="pill"
                                    data-target="base" type="button" role="tab">基本配置</button>
                                <button onclick="mosdnsui.btn.card()" class="nav-link " data-toggle="pill"
                                    data-target="high" type="button" role="tab">高级配置</button>
                                <button onclick="mosdnsui.btn.card()" class="nav-link " data-toggle="pill"
                                    data-target="api" type="button" role="tab">API 选项</button>
                            </div>
                        </div>

                        <div class="col-9">
                            <div class="tab-content">

                                <div data-parent="base" class="tab-pane fade active show" role="tabpanel">
                                    <div class="container custom_from">
                                        <div class="row align-items-start">
                                            <div class="col">启用</div>
                                            <div class="col-6">
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="checkbox" id="mosdnsActive" />
                                                </div>
                                            </div>
                                            <div class="col"></div>
                                        </div>
                                        <div class="row align-items-start">
                                            <div class="col">配置文件</div>
                                            <div class="col-6">
                                                <select class="form-control" id="config">
                                                    <option value="/etc/mosdns/config.yaml">内置预设</option>
                                                    <option value="/etc/mosdns/config_custom.yaml">自定义</option>
                                                </select>
                                            </div>
                                            <div class="col"></div>
                                        </div>
                                        <div class="row align-items-start">
                                            <div class="col">监听端口</div>
                                            <div class="col-6">
                                                <input id="port" value="" type="text" class="form-control">
                                            </div>
                                            <div class="col"></div>
                                        </div>
                                        <div class="row align-items-start">
                                            <div class="col">日志等级</div>
                                            <div class="col-6">
                                                <select id="loginfo" class="form-control" autocomplete="off">
                                                    <option value="debug">调试</option>
                                                    <option value="info">信息</option>
                                                    <option value="warn">警告</option>
                                                    <option value="error">错误</option>
                                                </select>
                                            </div>
                                            <div class="col"></div>
                                        </div>
                                        <div class="row align-items-start">
                                            <div class="col">日志文件</div>
                                            <div class="col-6">
                                                <input id="logfile" value="/var/log/mosdns.log" type="text"
                                                    class="form-control">
                                            </div>
                                            <div class="col"></div>
                                        </div>
                                        <div class="row align-items-start">
                                            <div class="col">国内DNS</div>
                                            <div id="chinadns" class="col-6">
                                                <div class="btn-group btn-group-custom chinadns">
                                                    <button data-tag="forward_local"
                                                        onclick="mosdnsui.btn.dns('chinadns')" type="button"
                                                        style="text-align: left; width: 90%;"
                                                        class="btn btn-secondary btn-dns-china btn-dns">请选择</button>
                                                    <button type="button" onclick="mosdnsui.btn.dns_remove()"
                                                        class="btn btn-secondary dropdown-toggle dropdown-toggle-split closed">
                                                        <span class="sr-only">Toggle Dropdown</span>
                                                    </button>
                                                    <div class="dropdown-menu"></div>
                                                </div>
                                            </div>
                                            <div class="col"></div>
                                        </div>
                                        <div class="row align-items-start">

                                            <div class="col">国外DNS</div>
                                            <div id="overseasdns" class="col-6">
                                                <div class="btn-group btn-group-custom overseasdns">
                                                    <button data-tag="forward_remote"
                                                        onclick="mosdnsui.btn.dns('overseasdns')" type="button"
                                                        style="text-align: left; width: 90%;"
                                                        class="btn btn-secondary btn-dns-overseas btn-dns">请选择</button>
                                                    <button type="button" onclick="mosdnsui.btn.dns_remove()"
                                                        class="btn btn-secondary dropdown-toggle dropdown-toggle-split closed">
                                                        <span class="sr-only">Toggle Dropdown</span>
                                                    </button>
                                                    <div class="dropdown-menu"></div>

                                                </div>

                                            </div>

                                            <div class="col"></div>
                                        </div>
                                        <div class="row align-items-start">

                                            <div class="col">Bootstrap DNS 服务器</div>
                                            <div class="col-6">
                                                <select class="form-control" id="bootstrapdns">
                                                </select>
                                            </div>

                                            <div class="col"></div>
                                        </div>
                                    </div>
                                </div>

                                <div data-parent="high" class="tab-pane fade show " role="tabpanel">
                                    <div class="container custom_from">
                                        <div class="row align-items-start">

                                            <div class="col">DNS 服务器并发数（默认 2）</div>
                                            <div class="col-6">
                                                <input id="concurrent" type="text" value="" class="form-control" />
                                            </div>

                                            <div class="col"></div>
                                        </div>

                                        <div class="row align-items-start">

                                            <div class="col">空闲超时</div>
                                            <div class="col-6">
                                                <input id="idle_timeout" type="text" value="" class="form-control" />
                                            </div>

                                            <div class="col"></div>
                                        </div>


                                        <div class="row align-items-start">

                                            <div class="col">DNS 缓存大小</div>
                                            <div class="col-6">
                                                <input id="size" type="text" value="" class="form-control lazy_cache" />
                                            </div>

                                            <div class="col"></div>
                                        </div>

                                        <div class="row align-items-start">

                                            <div class="col">DNS 乐观缓存 TTL</div>
                                            <div class="col-6">
                                                <input id="lazy_cache_ttl" type="text" value=""
                                                    class="form-control lazy_cache" />
                                            </div>

                                            <div class="col"></div>
                                        </div>

                                        <div class="row align-items-start">

                                            <div class="col">DNS 自动保存缓存</div>
                                            <div class="col-6">
                                                <input id="dump_interval" type="text" value=""
                                                    class="form-control lazy_cache" />
                                            </div>

                                            <div class="col"></div>
                                        </div>

                                        <div class="row align-items-start">

                                            <div class="col">缓存文件</div>
                                            <div class="col-6">
                                                <input id="dump_file" type="text" value=""
                                                    class="form-control lazy_cache" />
                                            </div>

                                            <div class="col"></div>
                                        </div>

                                        <div class="row align-items-start">

                                            <div class="col">覆盖最小 TTL 值（默认 0）</div>
                                            <div class="col-6">
                                                <input id="ttlmin" type="text" value="" class="form-control" />
                                            </div>

                                            <div class="col"></div>
                                        </div>

                                        <div class="row align-items-start">

                                            <div class="col">覆盖最大 TTL 值（默认 0）</div>
                                            <div class="col-6">
                                                <input id="ttlmax" type="text" value="" class="form-control" />
                                            </div>

                                            <div class="col"></div>
                                        </div>

                                        <div class="row align-items-start">

                                            <div class="col">TCP/DoT 连接复用</div>
                                            <div class="col-6">
                                                <div class="form-check">
                                                    <input id="enable_pipeline" class="form-check-input"
                                                        type="checkbox" />
                                                </div>
                                            </div>

                                            <div class="col"></div>
                                        </div>

                                        <div class="row align-items-start">

                                            <div class="col">禁用 TLS 证书</div>
                                            <div class="col-6">
                                                <div class="form-check">
                                                    <input id="insecure_skip_verify" class="form-check-input"
                                                        type="checkbox" />
                                                </div>
                                            </div>

                                            <div class="col"></div>
                                        </div>

                                        <div class="row align-items-start">

                                            <div class="col">防止 DNS 泄漏</div>
                                            <div class="col-6">
                                                <div class="form-check">
                                                    <input id="fallback" class="form-check-input" type="checkbox" />
                                                </div>
                                            </div>

                                            <div class="col"></div>
                                        </div>

                                        <div class="row align-items-start">

                                            <div class="col">启用 DNS 广告过滤</div>
                                            <div class="col-6">
                                                <div class="form-check">
                                                    <input id="adfilter" data-target="adfilter"
                                                        onclick="mosdnsui.btn.element_filter()" class="form-check-input"
                                                        type="checkbox" />
                                                </div>
                                            </div>

                                            <div class="col"></div>
                                        </div>

                                        <div data-parent="adfilter" class="row align-items-start custom-hide ">

                                            <div class="col">广告过滤规则来源</div>
                                            <div id="adfiltergroup" class="col-6">
                                                <div class="btn-group btn-group-custom">
                                                    <button onclick="mosdnsui.btn.dns('adfilter')" type="button"
                                                        style="text-align: left; width: 90%;"
                                                        class="btn btn-secondary btn-adfilter">请选择</button>
                                                    <button type="button" onclick="mosdnsui.btn.dns_remove()"
                                                        class="btn btn-secondary dropdown-toggle dropdown-toggle-split closed">
                                                        <span class="sr-only">Toggle Dropdown</span>
                                                    </button>
                                                    <div class="dropdown-menu">

                                                    </div>

                                                </div>
                                            </div>

                                            <div class="col"></div>
                                        </div>


                                        <div class="row align-items-start">

                                            <div class="col">启用 EDNS 客户端子网</div>
                                            <div class="col-6">
                                                <div class="form-check">
                                                    <input data-target="ednsfilter" disabled
                                                        onclick="mosdnsui.btn.element_filter()" class="form-check-input"
                                                        type="checkbox" />
                                                </div>
                                            </div>

                                            <div class="col"></div>
                                        </div>

                                        <div data-parent="ednsfilter" class="row align-items-start custom-hide ">

                                            <div class="col">IP 地址</div>
                                            <div class="col-6">
                                                <input type="text" value="" class="form-control" />
                                            </div>

                                            <div class="col"></div>
                                        </div>

                                    </div>
                                </div>

                                <div data-parent="api" class="tab-pane fade show " role="tabpanel">
                                    <div class="container custom_from">
                                        <div class="row align-items-start">

                                            <div class="col">API 监听端口</div>
                                            <div class="col-6">
                                                <input id="apiPort" type="text" value="" class="form-control" />
                                            </div>

                                            <div class="col"></div>
                                        </div>

                                        <div class="row align-items-start">

                                            <div class="col">刷新缓存</div>
                                            <div class="col-6">
                                                <button onclick="mosdnsui.btn.refreshcache()" type="button"
                                                    class="btn btn-info">刷新缓存</button>
                                            </div>

                                            <div class="col"></div>
                                        </div>

                                    </div>
                                </div>

                            </div>
                        </div>

                    </div>


                </div>



                <div class="tab-pane fade tab-pane-main show " id="nav-rule" role="tabpanel">
                    <div class="row" style="margin-top: 1.5rem">
                        <div class="col-3" style="border-right: 1px solid #dadada;">
                            <div class="nav flex-column nav-pills" role="tablist">
                                <button onclick="mosdnsui.btn.card()" class="nav-link active" data-toggle="pill"
                                    data-target="whitelist" type="button" role="tab">白名单</button>
                                <button onclick="mosdnsui.btn.card()" class="nav-link " data-toggle="pill"
                                    data-target="blacklist" type="button" role="tab">黑名单</button>
                                <button onclick="mosdnsui.btn.card()" class="nav-link " data-toggle="pill"
                                    data-target="greylist" type="button" role="tab">灰名单</button>
                                <button onclick="mosdnsui.btn.card()" class="nav-link " data-toggle="pill"
                                    data-target="ddnslist" type="button" role="tab">DDNS域名</button>
                                <button onclick="mosdnsui.btn.card()" class="nav-link " data-toggle="pill"
                                    data-target="hostslist" type="button" role="tab">Hosts</button>
                                <button onclick="mosdnsui.btn.card()" class="nav-link " data-toggle="pill"
                                    data-target="redirectionlist" type="button" role="tab">重定向</button>
                                <button onclick="mosdnsui.btn.card()" class="nav-link " data-toggle="pill"
                                    data-target="prtlist" type="button" role="tab">PRT 黑名单</button>
                            </div>
                        </div>
                        <div class="col-9">
                            <div id="customFilter" class="tab-content">

                                <div data-parent="whitelist" class="tab-pane fade show active" role="tabpanel">
                                    <div class="container custom_from">
                                        <div class="form-group">
                                            <textarea id="whitelist" data-tag="whitelist"
                                                data-file="/etc/mosdns/rule/whitelist.txt" class="form-control"
                                                rows="13"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div data-parent="blacklist" class="tab-pane fade show " role="tabpanel">
                                    <div class="container custom_from">
                                        <div class="form-group">
                                            <textarea id="blocklist" data-tag="blacklist"
                                                data-file="/etc/mosdns/rule/blocklist.txt" class="form-control"
                                                rows="13"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div data-parent="greylist" class="tab-pane fade show " role="tabpanel">
                                    <div class="container custom_from">
                                        <div class="form-group">
                                            <textarea id="greylist" data-tag="greylist"
                                                data-file="/etc/mosdns/rule/greylist.txt" class="form-control"
                                                rows="13"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div data-parent="ddnslist" class="tab-pane fade show " role="tabpanel">
                                    <div class="container custom_from">
                                        <div class="form-group">
                                            <textarea id="ddnslist" data-tag="ddnslist"
                                                data-file="/etc/mosdns/rule/ddnslist.txt" class="form-control"
                                                rows="13"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div data-parent="hostslist" class="tab-pane fade show " role="tabpanel">
                                    <div class="container custom_from">
                                        <div class="form-group">
                                            <textarea id="hosts" data-tag="hostslist"
                                                data-file="/etc/mosdns/rule/hosts.txt" class="form-control"
                                                rows="13"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div data-parent="redirectionlist" class="tab-pane fade show " role="tabpanel">
                                    <div class="container custom_from">
                                        <div class="form-group">
                                            <textarea id="redirect" data-tag="redirectionlist"
                                                data-file="/etc/mosdns/rule/redirect.txt" class="form-control"
                                                rows="13"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div data-parent="prtlist" class="tab-pane fade show " role="tabpanel">
                                    <div class="container custom_from">
                                        <div class="form-group">
                                            <textarea id="prtlist" data-tag="prtlist"
                                                data-file="/etc/mosdns/rule/local-ptr.txt" class="form-control"
                                                rows="13"></textarea>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                    </div>

                </div>

                <div class="tab-pane fade tab-pane-main show " id="nav-data" role="tabpanel">
                    <div class="row" style="margin-top: 1.5rem">
                        <div class="col-3" style="border-right: 1px solid #dadada;">
                            <div class="nav flex-column nav-pills" role="tablist">
                                <button class="nav-link active" data-toggle="pill" data-target="#v-pills-home"
                                    type="button" role="tab">更新广告规则、GeoIP & GeoSite 数据库</button>
                            </div>
                        </div>
                        <div class="col-9">
                            <div class="tab-content">

                                <div class="tab-pane fade show active" role="tabpanel">
                                    <div class="container custom_from">
                                        <div class="row align-items-start">

                                            <div class="col">启用自动更新</div>
                                            <div class="col-6">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" />
                                                </div>
                                            </div>

                                            <div class="col"></div>
                                        </div>
                                        <div class="row align-items-start">

                                            <div class="col">更新周期</div>
                                            <div class="col-6">
                                                <select class="form-control">
                                                    <option value="*">每天</option>
                                                    <option value="1">每周一</option>
                                                    <option value="2">每周二</option>
                                                    <option value="3">每周三</option>
                                                    <option value="4">每周四</option>
                                                    <option value="5">每周五</option>
                                                    <option value="6">每周六</option>
                                                    <option value="7">每周日</option>
                                                </select>
                                            </div>

                                            <div class="col"></div>
                                        </div>
                                        <div class="row align-items-start">

                                            <div class="col">更新时间</div>
                                            <div class="col-6">
                                                <select class="form-control">
                                                    <option value="0">0:00</option>
                                                    <option value="1">1:00</option>
                                                    <option value="2" selected="">2:00</option>
                                                    <option value="3">3:00</option>
                                                    <option value="4">4:00</option>
                                                    <option value="5">5:00</option>
                                                    <option value="6">6:00</option>
                                                    <option value="7">7:00</option>
                                                    <option value="8">8:00</option>
                                                    <option value="9">9:00</option>
                                                    <option value="10">10:00</option>
                                                    <option value="11">11:00</option>
                                                    <option value="12">12:00</option>
                                                    <option value="13">13:00</option>
                                                    <option value="14">14:00</option>
                                                    <option value="15">15:00</option>
                                                    <option value="16">16:00</option>
                                                    <option value="17">17:00</option>
                                                    <option value="18">18:00</option>
                                                    <option value="19">19:00</option>
                                                    <option value="20">20:00</option>
                                                    <option value="21">21:00</option>
                                                    <option value="22">22:00</option>
                                                    <option value="23">23:00</option>
                                                </select>
                                            </div>

                                            <div class="col"></div>
                                        </div>

                                        <div class="row align-items-start">

                                            <div class="col">数据库更新</div>
                                            <div class="col-6">
                                                <button onclick="mosdnsui.btn.geoUpdate()" type="button"
                                                    class="btn btn-info">检查并更新</button>
                                            </div>

                                            <div class="col"></div>
                                        </div>
                                        <div class="row align-items-start">
                                            <div data-update="geo" class="col"></div>
                                        </div>
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>

                </div>

                <div class="tab-pane fade tab-pane-main show " id="nav-install" role="tabpanel">
                    <div class="row" style="margin-top: 1.5rem">
                        <div class="col-3" style="border-right: 1px solid #dadada;">
                            <div class="nav flex-column nav-pills" role="tablist">
                                <button onclick="mosdnsui.btn.card()" class="nav-link active" data-toggle="pill"
                                    data-target="configInfo" type="button" role="tab">默认配置</button>
                                <button onclick="mosdnsui.btn.card()" class="nav-link" data-toggle="pill"
                                    data-target="install" type="button" role="tab">设置</button>
                            </div>
                        </div>
                        <div class="col-9">
                            <div class="tab-content">

                                <div data-parent="configInfo" class="tab-pane fade show active" role="tabpanel">
                                    <div class="container custom_from">
                                        <div class="row align-items-start">
                                            <div class="col">
                                                <div class="form-group">
                                                    <textarea id="configEdit" data-tag="config" class="form-control"
                                                        rows="15"></textarea>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>

                                <div data-parent="install" class="tab-pane fade show " role="tabpanel">
                                    <div class="container custom_from">
                                        <div class="row align-items-start">
                                            <div class="col">

                                                <button onclick="mosdnsui.btn.install()"
                                                    class="btn btn-info install-btn" type="button"
                                                    role="tab">保留配置安装</button>
                                                <button onclick="mosdnsui.btn.install('init')"
                                                    class="btn btn-info install-btn" type="button"
                                                    role="tab">初始化安装</button>
                                                <button onclick="mosdnsui.btn.uninstall()"
                                                    class="btn btn-info install-btn" type="button"
                                                    role="tab">卸载</button>

                                            </div>
                                        </div>
                                        <div class="row align-items-start">
                                            <div class="col">
                                                <div class="form-group">
                                                    <textarea disabled data-tag="install" class="form-control"
                                                        rows="10"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                </div>

            </div>
        </div>

    </div>

</body>

</html>